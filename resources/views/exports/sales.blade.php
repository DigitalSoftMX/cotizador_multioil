<table border="1">
    <thead>
        <tr>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2">{{ __('CLIENTE') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('¿FLETE? SI/NO') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2">{{ __('FLETERA') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                colspan="3">{{ __('PRECIO DE COMPRA ESTIMADO') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                colspan="3">{{ __('PRECIO DE VENTA A CLIENTES') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="18">
                <p style="text-align: justify;">{{ __('UTILIDAD ESTIMADA POR LITRO') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;"> {{ __('FECHA DE DESCARGA') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="13">{{ __('TIPO DE PRODUCTO') }} </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('LITROS SOLICITADOS') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="16">{{ __('COTIZACIÓN A COBRAR') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('LITROS DESPACHADOS') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('FOLIO BOL') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('DIFERENCIA EN LITROS') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('PAGO DEL CLIENTE') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('PAGO A PROVEEDOR VALERO') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="16">{{ __('PAGO A FLETERA') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="20">
                <p style="text-align: justify;">{{ __('FOLIO FACTURA PROVEEDOR') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="20">
                <p style="text-align: justify;">{{ __('CANTIDAD FACTURADA POR VALERO') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="20">
                <p style="text-align: justify;">{{ __('SALDO DEL PROVEEDOR') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="16">
                <p style="text-align: justify;">{{ __('COSTO REAL POR LITRO') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="16">
                <p style="text-align: justify;">{{ __('DIFERENCIA CON PC') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="13">{{ __('FOLIO FACTURA A CLIENTE') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('CANTIDAD FACTURADA A CLIENTE') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="13">{{ __('SALDO DE CLIENTE') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="20">
                <p style="text-align: justify;">{{ __('DIFERENCIA ENTRE FACTURAS') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">{{ __('UTILIDAD GENERAL') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('COMISIONISTA 1') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('COMISIONISTA 2') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('COMISIONISTA 3') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('UTILIDAD CLIENTE') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('UTILIDAD GUERRERA') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('UTILIDAD MULTIOIL') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;" align="center" bgcolor="#34495E" rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('UTILIDAD MULTIOIL SIN IVA') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="13">{{ __('IVA') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('20% DE CAJA CHICA') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="15">
                <p style="text-align: justify;">{{ __('DIF UT S/IVA - 20%') }}</p>
            </td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#34495E"
                rowspan="2" width="13">
                <p style="text-align: justify;">{{ __('UTILIDAD POR SOCIO') }}</p>
            </td>
        </tr>
        <tr>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#05AB00" width="12"
                height="20">{{ __('REGULAR') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#E40404"
                width="12">{{ __('PREMIUM') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="black" width="12">
                {{ __('DIÉSEL') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#05AB00"
                width="12">{{ __('REGULAR') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="#E40404"
                width="12">{{ __('PREMIUM') }}</td>
            <td style="font-weight:bold;color:#ffffff;vertical-align:center" align="center" bgcolor="black" width="12">
                {{ __('DIESEL') }}</td>
        </tr>
    </thead>
    <tbody>
        @php
            $month = $orders->first()->created_at->format('Y-m');
            $totalLitrosSolicitados = 0;
            $totalCotizacionACobrar = 0;
            $totalLitrosDespachados = 0;
            $totalFolioBol = 0;
            $totalPagoDelCliente = 0;
            $totalPagoAProveedorValero = 0;
            $totalPagoAfletera = 0;
            $totalCantidadFacturadaPorValero = 0;
            $totalCantidadFacturadaACliente = 0;
            $totalDiferenciaEntreFacturas = 0;
            $totalUtilidadGeneral = 0;
            $totalComisionista1 = 0;
            $totalComisionista2 = 0;
            $totalComisionista3 = 0;
            $totalUtilidadCliente=0;
            $totalUtilidadGuerrera = 0;
            $totalUtilidadMultioil = 0;
            $totalUtilidadMultioilSinIVA = 0;
            $totalIva = 0;
            $totalCajaChica = 0;
            $totaldifUtSIva20 = 0;
            $totalUtilidadPorSocio = 0;
        @endphp
        @foreach ($orders as $order)
            @if ($month != $order->created_at->format('Y-m'))
                @include('exports._trTableSales')
                @php
                    $month = $order->created_at->format('Y-m');
                    $totalLitrosSolicitados = 0;
                    $totalCotizacionACobrar = 0;
                    $totalLitrosDespachados = 0;
                    $totalFolioBol = 0;
                    $totalPagoDelCliente = 0;
                    $totalPagoAProveedorValero = 0;
                    $totalPagoAfletera = 0;
                    $totalCantidadFacturadaPorValero = 0;
                    $totalCantidadFacturadaACliente = 0;
                    $totalDiferenciaEntreFacturas = 0;
                    $totalUtilidadGeneral = 0;
                    $totalComisionista1 = 0;
                    $totalComisionista2 = 0;
                    $totalComisionista3 = 0;
                    $totalUtilidadCliente=0;
                    $totalUtilidadGuerrera = 0;
                    $totalUtilidadMultioil = 0;
                    $totalUtilidadMultioilSinIVA = 0;
                    $totalIva = 0;
                    $totalCajaChica = 0;
                    $totaldifUtSIva20 = 0;
                    $totalUtilidadPorSocio = 0;
                @endphp
            @endif
            <tr>
                <td width="40">{{ $order->company->name }}</td>
                <td>{{ $flete = $order->freight ? 'SI' : 'NO' }}</td>
                <td>{{ $order->name_freight ?? '-' }}</td>
                <td>{{ $regularCompra = $order->product == 'regular' ? $order->price : '' }}</td>
                <td>{{ $premiumCompra = $order->product == 'premium' ? $order->price : '' }}</td>
                <td>{{ $dieselCompra = $order->product == 'diesel' ? $order->price : '' }}</td>
                <td>{{ $regularVenta = $order->product == 'regular' ? $order->sale_price : '' }}</td>
                <td>{{ $premiumVenta = $order->product == 'premium' ? $order->sale_price : '' }}</td>
                <td>{{ $dieselVenta = $order->product == 'diesel' ? $order->sale_price : '' }}</td>
                <td>
                    @switch($order->product)
                        @case('regular')
                            {{ '$' . ($utilidadEstimadaPorLitro = $regularVenta - $regularCompra) }}
                        @break
                        @case('premium')
                            {{ '$' . ($utilidadEstimadaPorLitro = $premiumVenta - $premiumCompra) }}
                        @break
                        @case('diesel')
                            {{ '$' . ($utilidadEstimadaPorLitro = $dieselVenta - $dieselCompra) }}
                        @break
                    @endswitch
                </td>
                <td>{{ Carbon\Carbon::parse($order->date)->format('d/m/Y') }}</td>
                <td style="color:{{ $order->product == 'diesel' ? '#ffffff' : '' }};"
                    bgcolor="{{ $order->product == 'regular' ? '#05AB00' : ($order->product == 'premium' ? '#E40404' : '#000000') }}">
                    {{ strtoupper($order->product) }}</td>
                <td>{{ $litrosSolicitados = $order->liters }}</td>
                @php $totalLitrosSolicitados+=$litrosSolicitados; @endphp
                <td>{{ '$' . number_format($cotizacionACobrar = $order->sale_price * $order->liters, 2) }}</td>
                @php $totalCotizacionACobrar+=$cotizacionACobrar; @endphp
                <td>{{ $litrosDespachados = $order->dispatched_liters }}</td>
                @php $totalLitrosDespachados+=$litrosDespachados; @endphp
                <td>{{ $folioBol = $order->bol_load ?? '' }}/{{$folioBol2 = $order->bol_load2 ?? ''}}</td>
                @php 
                    $totalFolioBol += $folioBol == '' ? 0 : $folioBol; 
                    $totalFolioBol += $folioBol2 == '' ? 0 : $folioBol2;
                @endphp
                <td> {{ ($diferenciaEnLitros = $litrosSolicitados - $litrosDespachados)}} </td>
                <td>
                    {{ '$' . number_format($pagoDelCliente = $order->sale_price * $litrosDespachados, 2) }}
                    @php $totalPagoDelCliente+=$pagoDelCliente; @endphp
                </td>
                <td>{{ '$' . number_format($pagoAProveedorValero = $order->payments->sum('payment_g_valero'), 2) }}
                </td>
                @php $totalPagoAProveedorValero+=$pagoAProveedorValero; @endphp
                <td>{{ '$' . number_format($pagoAFletera = $order->invoice_shipper ? $order->invoice_shipper : $order->payments->sum('payment_freight'), 2) }}
                </td>
                @php $totalPagoAfletera+=$pagoAFletera; @endphp
                <td>{{ $facturaValeroGuerrera = $order->invoicecfdi }}</td>
                <td>{{ '$' . number_format($cantidadFacturadaPorValero = $order->invoicepayment + $order->invoicepayment2, 2) }}
                </td>
                @php $totalCantidadFacturadaPorValero+=$cantidadFacturadaPorValero; @endphp
                <td
                    style="color: {{ ($saldoDelProveedor = $cantidadFacturadaPorValero - $pagoAProveedorValero) <= 0 ? '#05AB00' : '#E40404' }}">
                    {{ '$' . number_format($saldoDelProveedor, 2) }}</td>
                <td>
                    @php
                        try {
                            echo '$' . number_format($costoRealPorLitro = $cantidadFacturadaPorValero / $litrosDespachados, 2);
                        } catch (\Throwable $th) {
                            $costoRealPorLitro = 0;
                            echo '';
                        }
                    @endphp
                </td>
                <td>{{ '$' . number_format($costoRealPorLitro - ($regularCompra != '' ? $regularCompra : ($premiumCompra != '' ? $premiumCompra : $dieselCompra)), 2) }}
                </td>
                <td>{{ "{$order->CFDI}/{$order->CFDI2}" }}</td>
                <td>
                    {{ '$' . number_format($cantidadFacturadaACliente = $order->amount ? $order->invoice + $order->invoice2 - $order->amount : $order->invoice + $order->invoice2, 2) }}
                </td>
                @php $totalCantidadFacturadaACliente+=$cantidadFacturadaACliente; @endphp
                <td>{{ '$' . number_format($saldoDelCliente = $cantidadFacturadaACliente - $pagoDelCliente,3) }}</td>
                <td>{{ '$' . number_format($diferenciaEntreFacturas = $cantidadFacturadaACliente - $cantidadFacturadaPorValero, 2) }}
                </td>
                @php $totalDiferenciaEntreFacturas+=$diferenciaEntreFacturas; @endphp
                <td>
                    {{ '$' . number_format($utilidadGeneral = $cantidadFacturadaACliente - $cantidadFacturadaPorValero - $pagoAFletera, 2) }}
                </td>
                @php $totalUtilidadGeneral+=$utilidadGeneral; @endphp
                <td>
                    {{ '$' . number_format($comisionista1 = ($order->commission ?? 0) * $litrosDespachados, 2) }}
                    @php $totalComisionista1+=$comisionista1; @endphp
                </td>
                <td>
                    {{ '$' . number_format($comisionista2 = ($order->commission_two ?? 0) * $litrosDespachados, 2) }}
                    @php $totalComisionista2+=$comisionista2; @endphp
                </td>
                <td>
                    {{ '$' . number_format($comisionista3 = ($order->commission_three ?? 0 )* $litrosDespachados, 2) }}
                    @php $totalComisionista3 += $comisionista3; @endphp
                </td>
                <td>
                    {{ '$' . number_format($utilidadCliente = $utilidadGeneral - $comisionista1 - $comisionista2 - $comisionista3,2) }}
                    @php $totalUtilidadCliente += $utilidadCliente; @endphp
                </td>
                <td>{{ '$' . number_format($utilidadGuerrera = ($utilidadCliente * 0.2), 2) }}</td>
                @php $totalUtilidadGuerrera += $utilidadGuerrera; @endphp
                <td>{{ '$' . number_format($utilidadMultioil = ($utilidadGeneral - $comisionista1 - $comisionista2) * 0.8, 2) }}
                </td>
                @php $totalUtilidadMultioil+=$utilidadMultioil; @endphp
                <td>{{ '$' . number_format($utilidadMultioilSinIVA = $utilidadMultioil / 1.16, 2) }}</td>
                @php $totalUtilidadMultioilSinIVA+=$utilidadMultioilSinIVA; @endphp
                <td>{{ '$' . number_format($iva = $utilidadMultioil - $utilidadMultioilSinIVA, 2) }}
                </td>
                @php $totalIva += $iva @endphp
                <td>{{ '$' . number_format($cajaChica = $utilidadMultioilSinIVA * 0.2, 2) }}</td>
                @php $totalCajaChica+=$cajaChica; @endphp
                <td>{{ '$' . number_format($difUtSIva20 = $utilidadMultioilSinIVA - $cajaChica, 2) }}
                </td>
                @php $totaldifUtSIva20+=$difUtSIva20; @endphp
                <td>{{ '$' . number_format($utilidadPorSocio = $difUtSIva20 / 2, 2) }}</td>
                @php $totalUtilidadPorSocio+=$utilidadPorSocio; @endphp
            </tr>
        @endforeach
        @include('exports._trTableSales')
    </tbody>
</table>
